FROM node:18-alpine3.18 as build
WORKDIR /app
COPY . .
# For computers with low internet speed
RUN yarn --network-timeout 1000000
# Get args
ARG VITE_PORT
ARG VITE_API_URL
ARG VITE_API_WS_URL
ARG VITE_EMAIL_SENDER_PUBKEY
ARG VITE_EMAIL_SENDER_SERVICEID
ARG VITE_EMAIL_SENDER_TEMPLATEID
ARG VITE_IV_BLOCK_PASSWD
ARG VITE_KEY_DECRYPT_PASSWD
ARG VITE_IMAGES_SERVER_URL
# Set env
ENV VITE_PORT=$VITE_PORT
ENV VITE_API_URL=$VITE_API_URL
ENV VITE_API_WS_URL=$VITE_API_WS_URL
ENV VITE_EMAIL_SENDER_PUBKEY=$VITE_EMAIL_SENDER_PUBKEY
ENV VITE_EMAIL_SENDER_SERVICEID=$VITE_EMAIL_SENDER_SERVICEID
ENV VITE_EMAIL_SENDER_TEMPLATEID=$VITE_EMAIL_SENDER_TEMPLATEID
ENV VITE_IV_BLOCK_PASSWD=$VITE_IV_BLOCK_PASSWD
ENV VITE_KEY_DECRYPT_PASSWD=$VITE_KEY_DECRYPT_PASSWD
ENV VITE_IMAGES_SERVER_URL=$VITE_IMAGES_SERVER_URL
RUN yarn build

FROM nginx:1.21.3-alpine as prod
COPY --from=build /app/build /usr/share/nginx/html
CMD ["nginx", "-g", "daemon off;"]
